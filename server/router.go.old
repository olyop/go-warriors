package main

import (
	"net/http"
	"time"

	customMiddleware "gowarriors/middleware"

	"github.com/go-chi/chi/v5"
	"github.com/go-chi/chi/v5/middleware"
)

// Serve is the HTTP handler that will be used by the server
var Serve http.Handler

// APIHandler returns a new HTTP handler that handles incoming requests
func APIHandler() *chi.Mux {
	router := chi.NewRouter()

	router.Use(middleware.RedirectSlashes)
	router.Use(middleware.Timeout(time.Second * 60))
	router.Use(middleware.Heartbeat("/heartbeat"))
	router.Use(middleware.AllowContentType("application/json"))
	router.Use(customMiddleware.ContentTypeJSON)

	router.Route("/api/v1", apiVersion1.CreateGoWarriorsAPIVersion1(nbaAPI))

	return router
}
